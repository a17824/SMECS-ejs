<html>
<head>
    <title>update utility user</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">  </script>
    <script>
        $(document).ready(function(){
            var userID,oldEmail,email,newPin, oldPin,confirmPin,note;
            $("#<%= utilityUsers.id %>").click(function(){
                userID=$(this).attr('id');
                oldEmail=$("#oldEmail").val();
                email=$("#email").val();
                oldPin=$("#oldPin").val();
                newPin=$("#newPin").val();
                confirmPin=$("#confirmPin").val();
                note=$("#note").val();

                //-----forms validation------------------------------------

                var mailFormat = /^([a-z A-Z 0-9 _\.\-])+\@(([a-z A-Z 0-9\-])+\.)+([a-z A-z 0-9]{2,4})+$/;
                if (!mailFormat.test(email)) {
                    alert("Please input a valid EMAIL address!");
                    return false;
                }
                if (newPin !== oldPin) {
                    var pinFormat = /^\d{4}$/;
                    if (!pinFormat.test(newPin)) {
                        alert("Pin code should be 4 digits ");
                        return false;
                    }
                    if (!pinFormat.test(confirmPin)) {
                        alert("Confirm Pin code should be 4 digits ");
                        return false;
                    }
                    if (newPin != confirmPin) {
                        alert("Pin and Confirm Pin don't match!");
                        return false;
                    }
                }


                //--------------------------------forms validation end-------
                var pin;
                if (newPin !== oldPin) {
                    pin = newPin;

                } else{
                    pin = "oldPin";
                }
                    $.post("/utilities/updateUtilityUser", {
                        userToUpdate: userID,
                        oldEmail: oldEmail,
                        email: email,
                        pin: pin,
                        note: note
                    },function(data){
                        if(data==='done')
                        {
                            alert("login success");
                        }
                        location.href = document.referrer;
                    }).error(function (error) {
                        if (error.responseText == 'showAlert')
                            alert("Email already in use. Choose a different Email .")
                    });

            });
        });
    </script>
</head>
<body>
<h1><%= title %></h1>
<form action="/dashboard">
    <input type="submit" value="Home"><br>
</form>
<form>
    <label for="email"><b>Email:</b></label><br>
    <input type="hidden" id="oldEmail" size="40" value="<%= utilityUsers.email %>">
    <input type="email" id="email" size="40" value="<%= utilityUsers.email %>" placeholder="ex: Manuel.Neves@gmail.com"><br><br>
    <label for="pin"><b>Pin:</b></label><br>
    <input type="hidden" id="oldPin" size="40" value="<%= utilityUsers.pin %>" placeholder="ex: 1234">
    <input type="password" id="newPin" size="40" value="<%= utilityUsers.pin %>"><br><br>
    <label for="confirmPin"><b>Confirm Pin:</b></label><br>
    <input type="password" id="confirmPin" size="40" value="<%= utilityUsers.pin %>" placeholder="ex: 1234"><br><br>
    <label for="note"><b>Note:</b></label><br>
    <input type="text" id="note" size="40" value="<%= utilityUsers.note %>" placeholder="ex: user for water problems"><br><br>

    <% if (aclModifyUsers == null || aclModifyUsers.checkBoxValue == true) {%>
    <input type="button" id=<%= utilityUsers.id %> value="Submit" ><br>
    <% } else { %>
    <input type="button" id=<%= utilityUsers.id %> value="Submit" disabled><br>
    <% } %>
</form>

<% if (aclModifyUsers == null || aclModifyUsers.checkBoxValue == true) {%>
<button class="backButton" onclick="goBack()">Back</button><br>
<% } else { %>
<button class="backButton" onclick="goBack()">Back</button><br>
<% } %>
<script>
    function goBack() {
        window.history.back();
    }
</script>

</body>
</html>