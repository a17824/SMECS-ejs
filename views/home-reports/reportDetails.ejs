
<!DOCTYPE html>
<html lang="en">
<head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <!-- Bootstrap -->
    <link href="/public/gentelella/vendors/bootstrap/dist/css/reportDetails.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="/public/gentelella/build/css/reportDetails.css" rel="stylesheet">
    <link href="/public/stylesheets/reportDetails.css" rel="stylesheet">


    <!-- lightbox (floor zoom) -->
    <link href="/public/lightbox2-master/dist/css/lightbox.css" rel="stylesheet">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">  </script>

    <script>
        //helpers
        function reply_click(whoNeedsHelpEmail)
        {
            let alert_ID = $("#alertID").val();
            let whoNeedsHelp = whoNeedsHelpEmail;

            $.post('/iWillHelp', {
                alertToUpdate: alert_ID,
                whoNeedsHelp: whoNeedsHelp

            }, function (data) {
                window.location = data.redirect
                //$("#needHelp").addClass('in');

            }).error(function (error) {
                if (error.responseText == 'showAlert')
                    alert("Sending Help wasn't successful, call SMECS APP team for help .")
            });
        }
        //end of helpers


        function reqAss()
        {
            var alert_ID = $("#alertID").val();
            var alertNameID = $("#alertNameID").val();
            var searchIDsNotChecked = $('input[name="checkboxRequest"]:not(:checked)').map(function () {
                return $(this).val();
            }).get();
            var searchIDsChecked = $('input[name="checkboxRequest"]:checked').map(function () {
                return $(this).val();
            }).get();


            //-----forms validation------------------------------------
            if ((alertNameID == 14 || alertNameID == 26) && searchIDsChecked.length < 1) {
                alert("To Request Assistance, you need to choose at least one type of contact.");
                return false;
            }
            //-------------------------------forms validation end-------

            $.post('/alerts/received/receivedAlert', {
                alertToUpdate: alert_ID,
                exitButton: false,
                reqAssChecked: searchIDsChecked,
                reqAssNotChecked: searchIDsNotChecked,
                redirectPage: '/reports/showReportsDetails/' + alert_ID + '/reportsPage'

            }, function (data) {
                if (data === 'done') {
                    alert("login success");
                }
                window.location = data.redirect
            }).error(function (error) {
                if (error.responseText == 'showAlert')
                    alert("App stop responding, call SMECS APP team for help .")
            });
        }


        $(document).ready(function(){

            let richNote = $("#richNote").val();
            //var note = document.getElementById('richNote').value;
            richDiv.innerHTML = richNote;

            // Alert UTILITY FAILURE

            $("#request").click(function() {

            });

            // END OF Alert UTILITY FAILURE

        });
    </script>
</head>

<body class="nav-md">
<div class="container body">

    <div class="main_container">
        <div class="col-md-3 left_col">
            <div class="left_col scroll-view">


                <!-- menu profile quick info -->
                <% include ../layout/menuProfile.ejs %>
                <!-- /menu profile quick info -->

                <br />
                <!-- sidebar menu -->
                <% include ../layout/sideMenu.ejs %>
                <!-- /sidebar menu -->
            </div>
        </div>

        <!-- top navigation -->
        <% include ../layout/topNavigation.ejs %>
        <!-- /top navigation -->

        <!-- page content -->


        <div class="right_col" role="main">
            <div class="">
                <div class="clearfix"></div>
                <div class="title_left">
                    <h2 align="center"><%= report.alertName %></h2>

                </div>
                <div class="lineSpace50"><br></div> <!-- smaller br -->

                <!-- iWillHelp -->
                <input type="hidden" id="alertID" value="<%= report._id %>">
                <!-- Gauges -->
                <input type="hidden" id="sentToWithPushTokenNumber" value="<%= total.sentToWithPushTokenNumber %>">
                <input type="hidden" id="sentToAllNumber" value="<%= total.sentToAllNumber %>">
                <input type="hidden" id="receivedNumber" value="<%= total.receivedNumber %>">
                <input type="hidden" id="viewedNumber" value="<%= total.viewedNumber %>">
                <input type="hidden" id="procedureDoneNumber" value="<%= total.procedureDoneNumber %>">
                <input type="hidden" id="weAreSafeNumber" value="<%= total.weAreSafeNumber %>">

                <input type="hidden" id="alertNameID" value="<%= report.alert.name %>">

                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2 class="gaugeTbig">Gauges<a class="gaugeTsmall">&emsp;<%= total.sentToAllNumber %> users in this scope. <%= total.sentToWithPushTokenNumber %> users with SMECS installed </a></h2>

                            <ul class="nav navbar-right panel_toolbox">
                                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                            </ul>

                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">

                            <% var pageColSize = 'col-md-3 col-sm-3 col-xs-6' %>
                            <% if (userAuthID == 1) {%>
                                <% pageColSize = 'col-md-2half col-sm-3 col-xs-6' %>
                            <% } %>

                            <% if (userAuthID == 1) {%>
                                <div class="col-md-2half col-sm-6 col-xs-6" align="center">
                                    <div class="x_content">
                                        <div class="dashboard-widget-content">
                                            <div class="reports-widget">
                                                <h4>Sent to</h4>
                                                <canvas id="chart_gauge_01" class="gaugeCan"></canvas>
                                                <div class="goal-wrapper">
                                                    <span id="gauge-text" class="gauge-value gauge-chart pull-left"></span>
                                                    <span class="gauge-value pull-left">&emsp;&emsp; users out of</span>
                                                    <span id="goal-text" class="goal-value pull-right"><%= total.sentToAllNumber %></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% } %>


                            <div class="<%= pageColSize %>" align="center">
                                <div class="x_content">
                                    <div class="dashboard-widget-content">
                                        <div class="reports-widget">
                                            <h4>Received by</h4>
                                            <canvas id="chart_gauge_02" class="gaugeCan"></canvas>
                                            <div class="goal-wrapper">
                                                <span id="gauge-text2" class="gauge-value gauge-chart pull-left"></span>
                                                <span class="gauge-value pull-left">&emsp;&emsp; users out of</span>
                                                <span id="goal-text2" class="goal-value pull-right"><%= total.sentToWithPushTokenNumber %></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>



                            <div class="<%= pageColSize %>" align="center">
                                <div class="x_content">
                                    <div class="dashboard-widget-content">
                                        <div class="reports-widget">
                                            <h4>Viewed by</h4>
                                            <canvas id="chart_gauge_03" class="gaugeCan"></canvas>
                                            <div class="goal-wrapper">
                                                <span id="gauge-text3" class="gauge-value gauge-chart pull-left"></span>
                                                <span class="gauge-value pull-left">&emsp;&emsp; users out of</span>
                                                <span id="goal-text3" class="goal-value pull-right"><%= total.receivedNumber %></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="<%= pageColSize %>" align="center">
                                <div class="x_content">
                                    <div class="dashboard-widget-content">
                                        <div class="reports-widget">
                                            <h4>Procedure finished</h4>
                                            <canvas id="chart_gauge_04" class="gaugeCan">2</canvas>
                                            <div class="goal-wrapper">
                                                <span id="gauge-text4" class="gauge-value gauge-chart pull-left"></span>
                                                <span class="gauge-value pull-left">&emsp;&emsp; users out of</span>
                                                <span id="goal-text4" class="goal-value pull-right"><%= total.viewedNumber %></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="<%= pageColSize %>" align="center">
                                <div class="x_content">
                                    <div class="dashboard-widget-content">
                                        <div class="reports-widget">
                                            <h4>We are safe</h4>
                                            <canvas width="150" height="80" id="chart_gauge_05" class="" style="width: 160px; height: 100px;"></canvas>
                                            <div class="goal-wrapper">
                                                <span id="gauge-text5" class="gauge-value gauge-chart pull-left"></span>
                                                <span class="gauge-value pull-left">&emsp;&emsp; users out of</span>
                                                <span id="goal-text5" class="goal-value pull-right"><%= total.viewedNumber %></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>



                        </div>



                    </div>
                </div>
                <!-- /Gauges -->

            </div>









            <div class="col-md-6 col-sm-12 col-xs-12">



                <!-- Users that... -->
                <div class="x_panel tile overflow_hidden">
                    <div class="x_title">
                        <h2 class="usersThat">Users that...</h2>

                        <ul class="nav navbar-right panel_toolbox">
                            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>

                            <li class="dropdown pull-right">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#">Sort by: default (mix)</a>
                                    <li><a href="#">Sort by: time received</a>
                                    <li><a href="#">Sort by: time viewed</a>
                                    <li><a href="#">Sort by: time procedure finished</a>
                                    <li><a href="#">Sort by: time we are safe</a>
                                </ul>
                            </li>


                        </ul>

                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">

                        <!-- start accordion -->
                        <div class="accordion" id="accordion1" role="tablist" aria-multiselectable="true">
                            <div class="panel">
                                <a class="panel-heading" role="tab" id="headingOne1" data-toggle="collapse" data-parent="#accordion1" href="#notReceive" aria-expanded="true" aria-controls="collapseOne">
                                    <h4 class="panel-title">
                                        <table class="" width="100%">
                                            <tr>
                                                <td class="no">didn't receive alert:</td>
                                                <td class="accor1Td2"><%= total.notReceivedNumber %></td>
                                                <td class="accor1Td3">users out of</td>
                                                <td class="accor1Td4"><%= total.sentToWithPushTokenNumber %></td>
                                            </tr>
                                        </table>
                                    </h4>
                                </a>
                                <div id="notReceive" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                                    <div class="panel-body">

                                        <ul class="list-unstyled msg_list">

                                            <% total.notReceivedBy.forEach(function(user, idx, array) { %>
                                                <% var imgPos = 'avatarSentUsers' %>
                                                <% var namePos = '' %>
                                                <%  if (idx === array.length - 1) { %> <!--  last loop  -->
                                                <!-- last user, picture and name need to be manual position -->
                                                <% imgPos = 'avatarSentUsers imgPositionLastLoop' %>
                                                <% namePos = 'namePos' %>
                                                <%  } %>

                                                <li class="imageSentUsers">
                                                    <%  if (user.photo !== '') { %>
                                                        <img src="/public/photosUsers/<%= user.photo %>" class="<%= imgPos %>" alt="Avatar" />
                                                    <%  }else { %>
                                                        <img src="/public/photosNotAvailable/user.png" class="<%= imgPos %>" alt="Avatar" />
                                                    <%  } %>
                                                    <span><span class="<%= namePos %>">&ensp;</span><span><%= user.firstName + ' ' + user.lastName %></span><span class="time compNot"><i><b>not completed</b></i></span></span>

                                                    <span class="message adjPos"><br>
                                                            received:
                                                        <%  if (user.received.receivedBoolean) { %>
                                                            <span class="yes"><%= user.received.receivedTime %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        viewed:
                                                        <%  if (user.viewed.viewedBoolean) { %>
                                                            <span class="yes"><%= user.viewed.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        procedure done:
                                                        <%  if (user.procedureCompleted.boolean) { %>
                                                            <span class="yes"><%= user.procedureCompleted.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        we are safe:
                                                        <%  if (user.weAreSafe.boolean) { %>
                                                            <span class="yes"><%= user.weAreSafe.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                    </span>
                                                </li>
                                            <% }); %>

                                        </ul>

                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <a class="panel-heading collapsed" role="tab" id="headingTwo1" data-toggle="collapse" data-parent="#accordion1" href="#notView" aria-expanded="false" aria-controls="collapseTwo">
                                    <h4 class="panel-title">
                                        <table class="" width="100%">
                                            <tr>
                                                <td class="no">didn't view alert:</td>
                                                <td class="accor1Td2"><%= total.notViewedNumber %></td>
                                                <td class="accor1Td3">users out of</td>
                                                <td class="accor1Td4"><%= total.receivedNumber %></td>
                                            </tr>
                                        </table>
                                    </h4>
                                </a>
                                <div id="notView" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                                    <div class="panel-body">

                                        <ul class="list-unstyled msg_list">

                                            <% total.notViewedBy.forEach(function(user, idx, array) { %>
                                                <% var imgPos = 'avatarSentUsers' %>
                                                <% var namePos = '' %>
                                                <%  if (idx === array.length - 1) { %> <!--  last loop  -->
                                                <!-- last user, picture and name need to be manual position -->
                                                <% imgPos = 'avatarSentUsers imgPositionLastLoop' %>
                                                <% namePos = 'namePos' %>
                                                <%  } %>

                                                <li class="imageSentUsers">
                                                    <%  if (user.photo !== '') { %>
                                                        <img src="/public/photosUsers/<%= user.photo %>" class="<%= imgPos %>" alt="Avatar" />
                                                    <%  }else { %>
                                                        <img src="/public/photosNotAvailable/user.png" class="<%= imgPos %>" alt="Avatar" />
                                                    <%  } %>
                                                    <span><span class="<%= namePos %>">&ensp;</span><span><%= user.firstName + ' ' + user.lastName %></span><span class="time compNot"><i><b>not completed</b></i></span></span>

                                                    <span class="message adjPos"><br>
                                                            received:
                                                        <%  if (user.received.receivedBoolean) { %>
                                                            <span class="yes"><%= user.received.receivedTime %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        viewed:
                                                        <%  if (user.viewed.viewedBoolean) { %>
                                                            <span class="yes"><%= user.viewed.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        procedure done:
                                                        <%  if (user.procedureCompleted.boolean) { %>
                                                            <span class="yes"><%= user.procedureCompleted.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        we are safe:
                                                        <%  if (user.weAreSafe.boolean) { %>
                                                            <span class="yes"><%= user.weAreSafe.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                    </span>
                                                </li>
                                            <% }); %>

                                        </ul>

                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <a class="panel-heading collapsed" role="tab" id="headingTwo1" data-toggle="collapse" data-parent="#accordion1" href="#notProcedure" aria-expanded="false" aria-controls="collapseTwo">
                                    <h4 class="panel-title">
                                        <table class="" width="100%">
                                            <tr>
                                                <td class="yesNo">didn't finish procedure:</td>
                                                <td class="accor1Td2"><%= total.notProcedureDoneNumber %></td>
                                                <td class="accor1Td3">users out of</td>
                                                <td class="accor1Td4"><%= total.viewedNumber %></td>
                                            </tr>
                                        </table>
                                    </h4>
                                </a>
                                <div id="notProcedure" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                                    <div class="panel-body">

                                        <ul class="list-unstyled msg_list">

                                            <% total.notProcedureDoneBy.forEach(function(user, idx, array) { %>
                                                <% var imgPos = 'avatarSentUsers' %>
                                                <% var namePos = '' %>
                                                <%  if (idx === array.length - 1) { %> <!--  last loop  -->
                                                <!-- last user, picture and name need to be manual position -->
                                                <% imgPos = 'avatarSentUsers imgPositionLastLoop' %>
                                                <% namePos = 'namePos' %>
                                                <%  } %>

                                                <li class="imageSentUsers">
                                                    <%  if (user.photo !== '') { %>
                                                        <img src="/public/photosUsers/<%= user.photo %>" class="<%= imgPos %>" alt="Avatar" />
                                                    <%  }else { %>
                                                        <img src="/public/photosNotAvailable/user.png" class="<%= imgPos %>" alt="Avatar" />
                                                    <%  } %>
                                                    <span><span class="<%= namePos %>">&ensp;</span><span><%= user.firstName + ' ' + user.lastName %></span><span class="time compNot2"><i><b>not completed</b></i></span></span>

                                                    <span class="message adjPos"><br>
                                                            received:
                                                        <%  if (user.received.receivedBoolean) { %>
                                                            <span class="yes"><%= user.received.receivedTime %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        viewed:
                                                        <%  if (user.viewed.viewedBoolean) { %>
                                                            <span class="yes"><%= user.viewed.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        procedure done:
                                                        <%  if (user.procedureCompleted.boolean) { %>
                                                            <span class="yes"><%= user.procedureCompleted.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        we are safe:
                                                        <%  if (user.weAreSafe.boolean) { %>
                                                            <span class="yes"><%= user.weAreSafe.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                    </span>
                                                </li>
                                            <% }); %>

                                        </ul>

                                    </div>
                                </div>
                            </div>
                            <div class="panel">
                                <a class="panel-heading collapsed" role="tab" id="headingTwo1" data-toggle="collapse" data-parent="#accordion1" href="#notSafe" aria-expanded="false" aria-controls="collapseTwo">
                                    <h4 class="panel-title">
                                        <table class="" width="100%">
                                            <tr>
                                                <td class="yesNo">are not safe:</td>
                                                <td class="accor1Td2"><%= total.notWeAreSafeNumber %></td>
                                                <td class="accor1Td3">users out of</td>
                                                <td class="accor1Td4"><%= total.viewedNumber %></td>
                                            </tr>
                                        </table>
                                    </h4>
                                </a>
                                <div id="notSafe" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                                    <div class="panel-body">

                                        <ul class="list-unstyled msg_list">
                                            <% total.notWeAreSafe.forEach(function(user, idx, array) { %>
                                                <% var imgPos = 'avatarSentUsers' %>
                                                <% var namePos = '' %>
                                                <%  if (idx === array.length - 1) { %> <!--  last loop  -->
                                                <!-- last user, picture and name need to be manual position -->
                                                <% imgPos = 'avatarSentUsers imgPositionLastLoop' %>
                                                <% namePos = 'namePos' %>
                                                <%  } %>

                                                <li class="imageSentUsers">
                                                    <%  if (user.photo !== '') { %>
                                                        <img src="/public/photosUsers/<%= user.photo %>" class="<%= imgPos %>" alt="Avatar" />
                                                    <%  }else { %>
                                                        <img src="/public/photosNotAvailable/user.png" class="<%= imgPos %>" alt="Avatar" />
                                                    <%  } %>
                                                    <span><span class="<%= namePos %>">&ensp;</span><span><%= user.firstName + ' ' + user.lastName %></span><span class="time compNot2"><i><b>not completed</b></i></span></span>

                                                    <span class="message adjPos"><br>
                                                            received:
                                                        <%  if (user.received.receivedBoolean) { %>
                                                            <span class="yes"><%= user.received.receivedTime %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        viewed:
                                                        <%  if (user.viewed.viewedBoolean) { %>
                                                            <span class="yes"><%= user.viewed.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        procedure done:
                                                        <%  if (user.procedureCompleted.boolean) { %>
                                                            <span class="yes"><%= user.procedureCompleted.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                        we are safe:
                                                        <%  if (user.weAreSafe.boolean) { %>
                                                            <span class="yes"><%= user.weAreSafe.timeDif %></span> &ensp;
                                                        <%  }else { %>
                                                            <span class="no">no</span> &ensp;
                                                        <%  } %>
                                                    </span>
                                                </li>
                                            <% }); %>

                                        </ul>

                                    </div>
                                </div>
                            </div>


                            <div class="panel">
                                <a class="panel-heading collapsed" role="tab" id="headingTwo1" data-toggle="collapse" data-parent="#accordion1" href="#needHelp" aria-expanded="false" aria-controls="collapseTwo">
                                    <h4 class="panel-title">
                                        <table class="" width="100%">
                                            <tr>
                                                <td class="yesNo">need help:</td>
                                                <td class="accor1Td2"><%= total.iNeedHelpNumber %></td>
                                                <td class="accor1Td3">users out of</td>
                                                <td class="accor1Td4"><%= total.viewedNumber %></td>
                                            </tr>
                                        </table>
                                    </h4>
                                </a>

                                <div id="needHelp" class="<%= classNames %>" role="tabpanel" aria-labelledby="headingTwo">
                                    <div class="panel-body">

                                        <table class="table table-striped">
                                            <thead>
                                            <tr>
                                                <th width="20">Photo</th>
                                                <th>Name</th>
                                                <th>Time</th>
                                                <th>helpers + Time</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <% total.iNeedHelp.forEach(function(user) { %>
                                                <tr>
                                                    <td>
                                                        <p class="imageSentUsers">
                                                            <%  if (user.photo !== '') { %>
                                                                <img src="/public/photosUsers/<%= user.photo %>" class="avatarSentUsers" alt="Avatar" />
                                                            <%  }else { %>
                                                                <img src="/public/photosNotAvailable/user.png" class="avatarSentUsers" alt="Avatar" />
                                                            <%  } %>
                                                        </p>
                                                    </td>
                                                    <td><%= user.firstName + ' ' + user.lastName %></td>
                                                    <td><%= user.iNeedHelp.time %></td>

                                                    <td>
                                                        <% if (user.iNeedHelp.helpers.length > 0) { %>
                                                            <% user.iNeedHelp.helpers.forEach(function(helper, idx, array) { %>
                                                                <p class="image">
                                                                    <%  if (helper.photo !== '') { %>
                                                                        <img src="/public/photosUsers/<%= helper.photo %>" class="avatarParents" alt="Avatar"/> <%=' ' + helper.firstName + ' ' + helper.lastName + ' ' + helper.timeDif %>
                                                                    <%  }else { %>
                                                                    <img src="/public/photosNotAvailable/user.png" class="avatarParents" alt="Avatar"/> <%=' ' + helper.firstName + ' ' + helper.lastName + ' ' + helper.timeDif %>
                                                                    <%  } %>
                                                                </p>
                                                                <%  if (idx === array.length - 1) { %> <!--  last loop  -->
                                                                <div class="ln_solidHalf"></div>
                                                                <%  } %>
                                                            <% }); %>
                                                        <%  } %>


                                                        <input type="button" class="btn btn-success btn-xs" id="<%= user.email %>" name="<%= user.email %>" value="I'm on my way to help" onClick="reply_click(this.id)">

                                                    </td>



                                                </tr>

                                            <% }); %>
                                            </tbody>
                                        </table>

                                    </div>
                                </div>
                            </div>


                            <div class="ln_solid"></div>

                            <div class="panel">
                                <a class="panel-heading collapsed" role="tab" id="headingTwo1" data-toggle="collapse" data-parent="#accordion1" href="#completedAll" aria-expanded="false" aria-controls="collapseTwo">
                                    <h4 class="panel-title">
                                        <table class="" width="100%">
                                            <tr>
                                                <td class="yes">completed all steps:</td>
                                                <td class="accor1Td2"><%= total.completedAllStepsNumber %></td>
                                                <td class="accor1Td3">users out of</td>
                                                <td class="accor1Td4"><%= total.viewedNumber %></td>
                                            </tr>
                                        </table>
                                    </h4>
                                </a>
                                <div id="completedAll" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                                    <div class="panel-body">


                                        <ul class="list-unstyled msg_list">

                                            <% total.completedAllStepsBy.forEach(function(user, idx, array) { %>
                                                <% var imgPos = 'avatarSentUsers' %>
                                                <% var namePos = '' %>
                                                <%  if (idx === array.length - 1) { %> <!--  last loop  -->
                                                <!-- last user, picture and name need to be manual position -->
                                                <% imgPos = 'avatarSentUsers imgPositionLastLoop' %>
                                                <% namePos = 'namePos' %>
                                                <%  } %>

                                                <li class="imageSentUsers">
                                                    <% if (user.photo !== '') { %>
                                                        <img src="/public/photosUsers/<%= user.photo %>" class="<%= imgPos %>" alt="Avatar" />
                                                    <% }else { %>
                                                        <img src="/public/photosNotAvailable/user.png" class="<%= imgPos %>" alt="Avatar" />
                                                    <% } %>
                                                    <span><span class="<%= namePos %>">&ensp;</span><span><%= user.firstName + ' ' + user.lastName %></span><span class="time compYes"><i><b>completed</b></i></span></span>

                                                    <span class="message adjPos"><br>
                                                        received: <span class="yes"><%= user.received.receivedTime %></span> &ensp;
                                                        viewed: <span class="yes"><%= user.viewed.timeDif %></span> &ensp;
                                                        procedure done: <span class="yes"><%= user.procedureCompleted.timeDif %></span> &ensp;
                                                        we are safe: <span class="yes"><%= user.weAreSafe.timeDif %></span> &ensp;
                                                    </span>
                                                </li>
                                            <% }); %>

                                        </ul>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <!-- end of accordion -->


                    </div>
                </div>
                <!-- /Users that... -->


                <!-- Call 911 -->
                <%  if (alertWith911) { %>
                    <div class="x_panel tile overflow_hidden">
                        <div class="x_title">
                            <h2 style="font-size: 28px">Call 911<a style="font-size: 12px">&emsp;This alert requires the following roles to call 911</a></h2>

                            <ul class="nav navbar-right panel_toolbox">
                                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                            </ul>

                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">

                            <!-- start accordion -->
                            <div class="accordion" id="accordion" role="tablist" aria-multiselectable="true">
                                <div class="panel">
                                    <a class="panel-heading collapsed" role="tab" id="headingTwo" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                        <h4 class="panel-title">
                                            <table class="" width="100%">
                                                <tr>
                                                    <td class="">who called 911:</td>
                                                    <td class="accor1Td2"><%= total.called911Number %></td>
                                                    <td class="accor1Td3">users out of</td>
                                                    <td class="accor1Td4"><%= total.viewedNumber %></td>
                                                </tr>
                                            </table>
                                        </h4>
                                    </a>
                                    <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                                        <div class="panel-body">
                                            <table class="table table-striped">
                                                <thead>
                                                <tr>
                                                    <th width="20">Photo</th>
                                                    <th>Name</th>
                                                    <th>Call time</th>
                                                    <th>Call duration</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <% total.called911By.forEach(function(user) { %>
                                                    <tr>
                                                        <td>
                                                            <p class="imageSentUsers">
                                                                <%  if (user.photo !== '') { %>
                                                                    <img src="/public/photosUsers/<%= user.photo %>" class="avatarSentUsers" alt="Avatar" />
                                                                <%  }else { %>
                                                                    <img src="/public/photosNotAvailable/user.png" class="avatarSentUsers" alt="Avatar" />
                                                                <%  } %>
                                                            </p>
                                                        </td>
                                                        <td><%= user.firstName %> <%= user.lastName %></td>
                                                        <td><%= user.called911.time %></td>
                                                        <td>10 min </td>
                                                    </tr>
                                                <% }); %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- end of accordion -->


                        </div>
                    </div>
                <% } %>
                <!-- Call 911 -->



                <!-- Roles sent to -->
                <div class="x_panel tile fixed_height_320 overflow_hidden">
                    <div class="x_title">
                        <h2 style="font-size: 28px">Roles sent to</h2>

                        <ul class="nav navbar-right panel_toolbox">
                            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                        </ul>

                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <table class="" style="width:100%">
                            <tr>
                                <th style="width:37%;">
                                    <p>Top 5</p>
                                </th>
                                <th>
                                    <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                        <p class="">Roles</p>
                                    </div>
                                    <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
                                        <p align="right" class="">Number of users</p>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <td>

                                    <canvas class="canvasDoughnut" height="140" width="140" style="margin: 15px 10px 10px 0"></canvas>
                                </td>
                                <td>
                                    <table class="tile_info">
                                        <tr>
                                            <td>
                                                <p><i class="fa fa-square orange"></i>Teacher </p>
                                            </td>
                                            <td class="numbersRight">20</td><!-- change values @ reportDetails.js lines [691,712] -->
                                        </tr>
                                        <tr>
                                            <td>
                                                <p><i class="fa fa-square blue"></i>Staff </p>
                                            </td>
                                            <td class="numbersRight">18</td><!-- change values @ reportDetails.js lines [691,712] -->
                                        </tr>
                                        <tr>
                                            <td>
                                                <p><i class="fa fa-square purple"></i>Office Staff </p>
                                            </td>
                                            <td class="numbersRight">10</td><!-- change values @ reportDetails.js lines [691,712] -->
                                        </tr>
                                        <tr>
                                            <td>
                                                <p><i class="fa fa-square red"></i>Principal </p>
                                            </td>
                                            <td class="numbersRight">1</td><!-- change values @ reportDetails.js lines [691,712] -->
                                        </tr>

                                        <tr>
                                            <td>
                                                <p><i class="fa fa-square aero"></i>Nurse </p>
                                            </td>
                                            <td class="numbersRight">1</td><!-- change values @ reportDetails.js lines [691,712] -->
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <!-- /Roles sent to -->




            </div>


            <div class="col-md-6 col-sm-12 col-xs-12">


                <!-- Alert details -->
                <div class="x_panel tile overflow_hidden">
                    <div class="x_title">
                        <h2 style="font-size: 28px">Alert details</h2>

                        <ul class="nav navbar-right panel_toolbox">
                            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                        </ul>

                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">

                        <form class="form-horizontal form-label-left input_mask">
                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">Group name</label>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <input type="text"
                                           class="form-control"
                                           id="alertName"
                                           value="<%= report.group.name %>" readonly>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">Alert name</label>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <input type="text"
                                           class="form-control"
                                           id="alertName"
                                           value="<%= report.alert.name %>" readonly>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">Type</label>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <input type="text"
                                           class="form-control"
                                           id="alertName"
                                           value="<%= report.realDrillDemo %>" readonly>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">Status</label>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <input type="text"
                                           class="form-control"
                                           id="alertName"
                                           value="<%= report.status.statusString %>" readonly>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">Sent by</label>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <input type="text"
                                           class="form-control"
                                           id="alertName"
                                           value="<%= report.sentBy %>" readonly>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">Date/Time created</label>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <input type="text"
                                           class="form-control"
                                           id="alertName"
                                           value="<%= report.sentDate %> / <%= report.sentTime %>" readonly>
                                </div>
                            </div>

                            <%  if (report.status.statusString === 'closed' ) { %>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Date/Time closed</label>
                                    <div class="col-md-9 col-sm-9 col-xs-12">
                                        <input type="text"
                                               class="form-control"
                                               id="alertName"
                                               value="<%= report.status.statusClosedDate %> / <%= report.status.statusClosedTime %>" readonly>
                                    </div>
                                </div>
                            <%  } %>

                            <div class="divider-dashed"></div>

                            <% if (report.alertWith.student) {%>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Student name</label>
                                    <div class="col-md-9 col-sm-9 col-xs-12">
                                        <ul class="form-control" readonly="">
                                            <p class="imageSentStudents alertWithStudent">
                                                <%= report.studentName %> &ensp;<img src="/public/alertSentInfo/studentsPhotos/<%= report.studentPhoto %>" class="avatarSentStudents alertWithStudentPhoto" alt="Avatar">
                                            </p>
                                        </ul>
                                    </div>
                                </div>

                                <% if (report.alertWith.missingStudent) {%>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Last time seen</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <input type="text"
                                                   class="form-control"
                                                   id="lastTimeSeen"
                                                   value="<%= report.missingChildLastTimeSeen %>" readonly>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Last place seen</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <input type="text"
                                                   class="form-control"
                                                   id="lastTimeSeen"
                                                   value="<%= report.missingChildLastPlaceSeen %>" readonly>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Clothes wearing</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <textarea id="clothesWearing"
                                                      class="form-control" readonly><%= report.missingChildClothesWearing %>
                                            </textarea>
                                        </div>
                                    </div>
                                <%  } %>

                                <% if (report.alertWith.notesStudentWithGun) {%>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">He/she is seated</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <textarea id="behaviour"
                                                      class="form-control"
                                                      placeholder="n/a" readonly><%= report.studentWithGunSeated %>
                                            </textarea>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Current behaviour</label>
                                        <div class="col-md-9 col-sm-9 col-xs-12">
                                            <textarea id="behaviour"
                                                      class="form-control"
                                                      placeholder="n/a" readonly><%= report.studentWithGunBehaviour %>
                                            </textarea>
                                        </div>
                                    </div>
                                <%  } %>
                            <%  } %>

                            <% if (report.alertWith.materialSpill) {%>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Description of type of material, odor, etc.</label>
                                    <div class="col-md-9 col-sm-9 col-xs-12">
                                            <textarea id="behaviour"
                                                      class="form-control"
                                                      placeholder="n/a" readonly><%= report.materialSpill %>
                                            </textarea>
                                    </div>
                                </div>
                            <%  } %>

                            <% if (report.alertWith.notes) {%>
                                <input type="hidden" id="richNote" value="<%= report.note %>">
                                <!-- /* showReportDetails - box for NOTES */ file: ...vendors\boots..\dist\css\reportDetails.css -->
                                <!-- /* line space for NOTES */ file: ...build\css\reportDetails.css -->
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Note</label>
                                    <div class="col-md-9 col-sm-9 col-xs-12">
                                        <% if (report.note) {%>
                                            <div type="text"
                                                 class="form-control"
                                                 id="richDiv">
                                            </div>
                                        <% } else {%>
                                            <textarea id="behaviour" class="form-control" readonly></textarea>
                                        <% } %>
                                    </div>
                                </div>
                            <%  } %>

                            <% if (report.alertWith.multiUtilities) {%>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Situation</label>
                                    <div class="col-md-9 col-sm-9 col-xs-12">
                                        <div type="text" class="form-control" id="multi">
                                            <% arraySituations.forEach(function(situation, idx, array) { %>

                                                <input type="checkbox" name="checkbox" value="<%= situation.utilityName %>" checked onclick="return false;">
                                                <label for="utilityName" class="textSize"><%= situation.utilityName %></label><br>

                                                <% if (canRequestAssistance == true) {%>
                                                    <% if (situation.arrayButtons.length < 1) {%>
                                                        <label for="utilityName" class="textSize spaces5 upDown textColor">(no contacts available)</label><br>
                                                    <% } %>

                                                    <% situation.arrayButtons.forEach(function(button) { %>

                                                        <div class="thinnerLine3">
                                                            <span class="<%= button.spacesA %>"></span><label for="utilityName" class="upDown"><%= button.radioLabel %></label><span class="<%= button.spacesB %>"></span>
                                                            <div class="<%= button.radioSent.onOffSwitch %>">
                                                                <input type="checkbox" class="<%= button.radioSent.checkbox %>" name="checkboxRequest" id="<%= situation.utilityID %>+<%= button.radioLabel %>" value="<%= button.value %>" <%= button.radioChecked %>>
                                                                <label class="<%= button.radioSent.label %>" for="<%= situation.utilityID %>+<%= button.radioLabel %>">
                                                                    <span class="<%= button.radioSent.inner %>"></span>
                                                                    <span class="<%= button.radioSent.switch_ %>"></span>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    <% }); %>

                                                    <%  if (idx === array.length - 1) { %> <!--  last loop: put button  -->
                                                    <br>
                                                    <%  if (disableReqButton) { %>
                                                        <input type="button" class="btn btn-success btn-xs right" id="request" value="Send Request Assistance" disabled>
                                                    <% } else { %>
                                                        <input type="button" class="btn btn-success btn-xs right" id="request" value="Send Request Assistance" onClick="reqAss()">
                                                    <% } %>


                                                    <% } %>
                                                <% } %>

                                            <% }); %>
                                        </div>
                                    </div>
                                </div>
                            <% } %>

                            <% if (report.alertWith.multiMedical) {%>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Situation</label>
                                    <div class="col-md-9 col-sm-9 col-xs-12">
                                        <div type="text" class="form-control" id="multi">
                                            <% for (var i=0; i < report.multiSelectionNames.length; i++) {%>
                                                <input type="checkbox" name="checkbox" value="<%= report.multiSelectionNames[i] %>" checked onclick="return false;">
                                                <label for="utilityName"><%= report.multiSelectionNames[i] %></label><br>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                            <% } %>

                            <% if (report.alertWith.floor) {%>
                                <div class="form-group <%= report.alertWith.htmlTags.showHideDiv %>">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Building</label>
                                    <div class="col-md-9 col-sm-9 col-xs-12">
                                        <input type="text"
                                               class="form-control"
                                               id="building"
                                               value="<%= report.buildingName %>" readonly>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12"><%= report.alertWith.htmlTags.labelFloor %></label>
                                    <div class="col-md-9 col-sm-9 col-xs-12">
                                        <input type="text"
                                               class="form-control"
                                               id="building"
                                               value="<%= report.floorName %>" readonly>
                                    </div>
                                </div>

                                <div class="form-group">



                                    <div class="col-md-9 col-sm-9 col-xs-12">
                                        <% if ( report.floorPhoto !== report._id + '_FloorPhotoNotExist' &&
                                                report.floorPhoto !== '' &&
                                                report.floorPhoto !== report._id + '_Multiple floors' &&
                                                report.floorPhoto !== report._id + '_Multiple Locations' &&
                                                report.floorPhoto !== report._id + '_skipped by user' &&
                                                report.floorPhoto !== report._id + '_Outside Building' &&
                                                report.floorPhoto !== report._id + '_undefined') {%> <!-- user selected a floor -->

                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Floor plan</label>

                                        <a href="/public/alertSentInfo/floorsPhotos/<%= report.floorPhoto %>" data-lightbox="image-1" data-title="2nd Floor">
                                            <img src="/public/alertSentInfo/floorsPhotos/<%= report.floorPhoto %>" class="form-control floor" alt="Avatar" readonly/>
                                        </a>
                                        <% } %>

                                    </div>
                                </div>
                            <%  } %>

                        </form>


                    </div>
                </div>
                <!-- Alert details -->





            </div>





            <!-- this div is needed for 'footer' to stay at the bottom of the page -->
            <div class="row">

            </div>
            <!-- ebd of this div is needed for 'footer' to stay at the bottom of the page -->

        </div>
        <!-- /page content -->

    </div>
</div>

<!-- jQuery -->
<script src="/public/gentelella/vendors/jquery/dist/jquery.js"></script>


<!-- Bootstrap -->
<script src="/public/gentelella/vendors/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- FastClick -->
<script src="/public/gentelella/vendors/fastclick/lib/fastclick.js"></script>
<!-- NProgress -->
<script src="/public/gentelella/vendors/nprogress/nprogress.js"></script>
<!-- Chart.js -->
<script src="/public/gentelella/vendors/Chart.js/dist/Chart.min.js"></script>
<!-- gauge.js -->
<script src="/public/gentelella/vendors/gauge.js/dist/gauge.min.js"></script>
<!-- bootstrap-progressbar -->
<script src="/public/gentelella/vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
<!-- iCheck -->
<script src="/public/gentelella/vendors/iCheck/icheck.min.js"></script>
<!-- Skycons -->
<script src="/public/gentelella/vendors/skycons/skycons.js"></script>
<!-- Flot -->
<script src="/public/gentelella/vendors/Flot/jquery.flot.js"></script>
<script src="/public/gentelella/vendors/Flot/jquery.flot.pie.js"></script>
<script src="/public/gentelella/vendors/Flot/jquery.flot.time.js"></script>
<script src="/public/gentelella/vendors/Flot/jquery.flot.stack.js"></script>
<script src="/public/gentelella/vendors/Flot/jquery.flot.resize.js"></script>
<!-- Flot plugins -->
<script src="/public/gentelella/vendors/flot.orderbars/js/jquery.flot.orderBars.js"></script>
<script src="/public/gentelella/vendors/flot-spline/js/jquery.flot.spline.min.js"></script>
<script src="/public/gentelella/vendors/flot.curvedlines/curvedLines.js"></script>
<!-- DateJS -->
<script src="/public/gentelella/vendors/DateJS/build/date.js"></script>
<!-- JQVMap -->
<script src="/public/gentelella/vendors/jqvmap/dist/jquery.vmap.js"></script>
<script src="/public/gentelella/vendors/jqvmap/dist/maps/jquery.vmap.world.js"></script>
<script src="/public/gentelella/vendors/jqvmap/examples/js/jquery.vmap.sampledata.js"></script>
<!-- bootstrap-daterangepicker -->
<script src="/public/gentelella/vendors/moment/min/moment.min.js"></script>
<script src="/public/gentelella/vendors/bootstrap-daterangepicker/daterangepicker.js"></script>



<!-- Custom Theme Scripts -->
<script src="/public/gentelella/build/js/reportDetails.js"></script>

<!-- lightbox (floor zoom) -->
<script src="/public/lightbox2-master/dist/js/lightbox.js"></script>


</body>
<!-- footer content -->
<footer class="">
    <% include ../layout/footer.ejs %>
    <div class="clearfix"></div>
</footer>
<!-- /footer content -->
</html>
