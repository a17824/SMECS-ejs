<html>
<head>
    <title>Choose Alert</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">  </script>
    <link rel='stylesheet' href='/stylesheets/chooseAlert.css' />
    <script>
        $(document).ready(function(){

            $('input[name=onoffswitch]').change(function(){
                if($('#myonoffswitch').is(':checked')) {
                    $('#testModeOFF').css('display', "none");
                    $('#testModeON').css('display', "unset");
                    $('input[name=alert]:checked').attr('checked',false) //uncheck checkbox from OFF radios
                }
                else{
                    $('#testModeON').css('display', "none");
                    $('#testModeOFF').css('display', "unset");
                }
            });
            var testModeON = false;

            var alertGroupID, alertGroupName, groupIcon;
            $("#btSubmit").click(function(){
                alertGroupID = $('input[name=alert]:checked').val();
                alertGroupName = $("input:radio[name='alert']:checked + label").text();
                groupIcon = $("#groupIcon").val();

                if ($('input[name=onoffswitch]:checked').length > 0) {
                    testModeON = true;
                }

                //-----forms validation------------------------------------

                if (alertGroupID == null ) {
                    alert("You must choose one Alert");
                    return false;
                }
                //--------------------------------forms validation end-------

                $.post("/alerts/sending/chooseGroup",{
                    alertGroupID: alertGroupID,
                    alertGroupName: alertGroupName,
                    groupIcon: groupIcon,
                    testModeON: testModeON

                },function(data){
                    if(data==='done')
                    {
                        alert("login success");
                    }
                    window.location = data.redirect
                }).error(function(error){
                    if(error.responseText == 'showAlert')
                        alert("Alert not sent.")
                });
            });
        });
    </script>
</head>
<body>
<h1><%= title %></h1>

<% if ( error_messages ) { %>
<p style="color: red"><%- error_messages %></p><br>
<% } %>


<% if ( aclTest.length >=1 ) { %>
<div class="onoffswitch">
    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch">
    <label class="onoffswitch-label" for="myonoffswitch">
        <span class="onoffswitch-inner"></span>
        <span class="onoffswitch-switch"></span>
    </label>
</div>
<% } %>

<br>



<form>
    <div id='testModeOFF' name="testModeOFF">
        <% for (var i=0; i < aclReal.length; i++ ){ %>
        <input type="hidden" id="groupIcon" value="<%= aclReal[i].group.icon %>">

        <input type="radio" name="alert" id="<%= aclReal[i].group.groupID %>" value="<%= aclReal[i].group.groupID %>" >
        <label for="alert"
               style="background-color: <%= aclReal[i].group.color.bgValue %>;color: <%= aclReal[i].group.color.textValue %>"
               id="<%= aclReal[i].alertColor %>"
        ><%= aclReal[i].group.name %></label><br>
        <% } %>
    </div>

    <div id='testModeON' name="testModeON" style='display:none'>
        <% for (var i=0; i < aclTest.length; i++ ){ %>
        <input type="radio" name="alert" id="<%= aclTest[i].group.groupID %>" value="<%= aclTest[i].group.groupID %>" >
        <label for="alert"
               style="background-color: <%= aclTest[i].group.color.bgValue %>;color: <%= aclTest[i].group.color.textValue %>"
        ><%= aclTest[i].group.name %></label><br>
        <% } %>
    </div>
    <br>
    <input type="button" style="width: 10em; height: 1.8em" id="btSubmit" value="Next" ><br>
</form>

<form action="/dashboard">
    <input type="submit" value="Back">
</form>

</body>
</html>